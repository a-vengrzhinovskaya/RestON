<template>
  <div class="closed-checks">
    <div class="content-header">
      <div class="header-group">
        <h2>–ó–∞–∫—Ä—ã—Ç—ã–µ —á–µ–∫–∏</h2>
        <div class="date-selector" @click="openPeriodModal">
          <span class="calendar-icon">üìÖ</span>
          <span>{{ formatDateRange(selectedStartDate, selectedEndDate) }}</span>
        </div>
      </div>
    </div>

    <div class="checks-container">
      <table class="checks-table">
        <thead>
          <tr>
            <th>–ù–æ–º–µ—Ä —á–µ–∫–∞</th>
            <th>–°—Ç–æ–ª</th>
            <th>–ó–∞–∫—Ä—ã—Ç</th>
            <th>–ö –æ–ø–ª–∞—Ç–µ</th>
            <th>–í—ã—Ä—É—á–∫–∞</th>
          </tr>
        </thead>
        <tbody>
          <tr @click="showCheckDetails('T-231')" :class="{ active: selectedCheck === 'T-231' }">
            <td>T-231</td>
            <td>1 —Å—Ç–æ–ª</td>
            <td>12 –∏—é–Ω—è –≤ 13:30</td>
            <td>589 ‚ÇΩ</td>
            <td>589 ‚ÇΩ</td>
          </tr>
          <tr @click="showCheckDetails('T-230')" :class="{ active: selectedCheck === 'T-230' }">
            <td>T-230</td>
            <td>3 —Å—Ç–æ–ª</td>
            <td>12 –∏—é–Ω—è –≤ 13:15</td>
            <td>1250 ‚ÇΩ</td>
            <td>1250 ‚ÇΩ</td>
          </tr>
          <tr @click="showCheckDetails('T-229')" :class="{ active: selectedCheck === 'T-229' }">
            <td>T-229</td>
            <td>2 —Å—Ç–æ–ª</td>
            <td>12 –∏—é–Ω—è –≤ 13:00</td>
            <td>890 ‚ÇΩ</td>
            <td>890 ‚ÇΩ</td>
          </tr>
          <tr @click="showCheckDetails('T-228')" :class="{ active: selectedCheck === 'T-228' }">
            <td>T-228</td>
            <td>4 —Å—Ç–æ–ª</td>
            <td>12 –∏—é–Ω—è –≤ 12:45</td>
            <td>1780 ‚ÇΩ</td>
            <td>1780 ‚ÇΩ</td>
          </tr>
          <tr @click="showCheckDetails('T-227')" :class="{ active: selectedCheck === 'T-227' }">
            <td>T-227</td>
            <td>1 —Å—Ç–æ–ª</td>
            <td>12 –∏—é–Ω—è –≤ 12:30</td>
            <td>670 ‚ÇΩ</td>
            <td>670 ‚ÇΩ</td>
          </tr>
          <tr @click="showCheckDetails('T-226')" :class="{ active: selectedCheck === 'T-226' }">
            <td>T-226</td>
            <td>5 —Å—Ç–æ–ª</td>
            <td>12 –∏—é–Ω—è –≤ 12:15</td>
            <td>2340 ‚ÇΩ</td>
            <td>2340 ‚ÇΩ</td>
          </tr>
          <tr @click="showCheckDetails('T-225')" :class="{ active: selectedCheck === 'T-225' }">
            <td>T-225</td>
            <td>2 —Å—Ç–æ–ª</td>
            <td>12 –∏—é–Ω—è –≤ 12:00</td>
            <td>950 ‚ÇΩ</td>
            <td>950 ‚ÇΩ</td>
          </tr>
        </tbody>
      </table>

      <!-- Check details sidebar -->
      <div v-if="selectedCheck" class="check-details">
        <div class="details-header">
          <h3>–ß–µ–∫ {{ selectedCheck }}</h3>
          <button class="close-btn" @click="selectedCheck = null">√ó</button>
        </div>

        <div class="details-info">
          <div class="info-row">
            <span class="label">–°—Ç–æ–ª:</span>
            <span class="value">1</span>
          </div>
          <div class="info-row">
            <span class="label">–ì–æ—Å—Ç–µ–π:</span>
            <span class="value">2</span>
          </div>
          <div class="info-row">
            <span class="label">–û—Ç–∫—Ä—ã—Ç:</span>
            <span class="value">12 –∏—é–Ω—è 13:28</span>
          </div>
          <div class="info-row">
            <span class="label">–ó–∞–∫—Ä—ã—Ç:</span>
            <span class="value">12 –∏—é–Ω—è 13:30</span>
          </div>
        </div>

        <div class="details-items">
          <table>
            <thead>
              <tr>
                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                <th>–ö–æ–ª-–≤–æ</th>
                <th>–¶–µ–Ω–∞</th>
                <th>–ò—Ç–æ–≥–æ</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>–î–æ–Ω–µ—Ä</td>
                <td>2</td>
                <td>250 ‚ÇΩ</td>
                <td>500 ‚ÇΩ</td>
              </tr>
              <tr>
                <td>–ö–æ–ª–∞ 0.5–ª</td>
                <td>1</td>
                <td>89 ‚ÇΩ</td>
                <td>89 ‚ÇΩ</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="details-total">
          <div class="total-row">
            <span>–ò—Ç–æ–≥–æ:</span>
            <span class="amount">589 ‚ÇΩ</span>
          </div>
          <div class="total-row">
            <span>–û–ø–ª–∞—á–µ–Ω–æ –∫–∞—Ä—Ç–æ–π:</span>
            <span class="amount">589 ‚ÇΩ</span>
          </div>
        </div>
      </div>
    </div>

    <PeriodModal 
      :is-open="isPeriodModalOpen"
      @close="isPeriodModalOpen = false"
      @save="handlePeriodSave"
    />
  </div>
</template>

<script setup lang="ts">
import { ref, computed } from 'vue'
import PeriodModal from './PeriodModal.vue'

const selectedCheck = ref<string | null>(null)
const isPeriodModalOpen = ref(false)
const selectedStartDate = ref<Date | null>(null)
const selectedEndDate = ref<Date | null>(null)

const currentDate = computed(() => new Date())

const showCheckDetails = (checkNumber: string) => {
  selectedCheck.value = checkNumber
}

const openPeriodModal = () => {
  isPeriodModalOpen.value = true
}

const handlePeriodSave = (period: { startDate: Date; endDate: Date; startTime: string; endTime: string }) => {
  selectedStartDate.value = period.startDate
  selectedEndDate.value = period.endDate
  isPeriodModalOpen.value = false
}

const formatDate = (date: Date | null) => {
  if (!date) return null
  const day = date.getDate()
  const month = date.toLocaleString('ru', { month: 'long' })
  return `${day} ${month}`
}

const formatDateRange = (startDate: Date | null, endDate: Date | null) => {
  if (!startDate) {
    return `–ó–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é —Å–º–µ–Ω—É - ${formatDate(currentDate.value)}`
  }
  
  if (!endDate || startDate.toDateString() === endDate.toDateString()) {
    return formatDate(startDate)
  }
  return `${formatDate(startDate)} ‚Äî ${formatDate(endDate)}`
}
</script>

<style scoped>
.closed-checks {
  height: 100%;
  display: flex;
  flex-direction: column;
}

.content-header {
  margin-bottom: 1.5rem;
}

.header-group {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.content-header h2 {
  font-size: 1.25rem;
  font-weight: 600;
  color: #1a1a1a;
  white-space: nowrap;
}

.date-selector {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: #1a1a1a;
  font-size: 0.875rem;
  padding: 0.5rem 0.75rem;
  background: white;
  border: 1px solid #4338ca;
  border-radius: 6px;
  cursor: pointer;
  transition: background-color 0.2s;
}

.date-selector:hover {
  background: #f8f9fa;
}

.calendar-icon {
  color: #4338ca;
}

.checks-container {
  display: flex;
  gap: 1.5rem;
  height: 100%;
}

.checks-table {
  flex: 1;
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  background: white;
  border-radius: 12px;
  overflow: hidden;
}

.checks-table thead tr {
  background: #f8f9fa;
}

.checks-table th {
  padding: 1rem;
  text-align: left;
  font-weight: 500;
  color: #1a1a1a;
  border-bottom: 1px solid #e9ecef;
}

.checks-table td {
  padding: 1rem;
  border-bottom: 1px solid #e9ecef;
}

.checks-table tbody tr {
  cursor: pointer;
  transition: background-color 0.2s;
}

.checks-table tbody tr:hover {
  background-color: #f8f9fa;
}

.checks-table tbody tr.active {
  background-color: #f8f9fa;
}

.check-details {
  width: 400px;
  background: white;
  border-radius: 12px;
  padding: 1.5rem;
  height: fit-content;
}

.details-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
}

.details-header h3 {
  font-size: 1.25rem;
  font-weight: 600;
  color: #1a1a1a;
}

.close-btn {
  background: none;
  border: none;
  font-size: 1.5rem;
  color: #6c757d;
  cursor: pointer;
  padding: 0.25rem;
}

.details-info {
  margin-bottom: 2rem;
}

.info-row {
  display: flex;
  justify-content: space-between;
  margin-bottom: 0.75rem;
}

.info-row .label {
  color: #6c757d;
}

.details-items table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 2rem;
}

.details-items th {
  text-align: left;
  padding: 0.75rem;
  border-bottom: 1px solid #e9ecef;
  color: #6c757d;
  font-weight: normal;
}

.details-items td {
  padding: 0.75rem;
  border-bottom: 1px solid #e9ecef;
}

.details-total {
  border-top: 1px solid #e9ecef;
  padding-top: 1rem;
}

.total-row {
  display: flex;
  justify-content: space-between;
  margin-bottom: 0.75rem;
  font-weight: 500;
}

.amount {
  color: #1a1a1a;
}
</style> 